<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>p3dpy viz</title>
</head>
<body>
    <canvas id="myCanvas"></canvas>
    <script src="/static/js/three.js"></script>
    <script src="/static/js/OrbitControls.js"></script>
    <script type="module">
      import Stats from '/static/js/stats.module.js';
      import { GUI } from '/static/js/dat.gui.module.js';
      let camera, scene, renderer;
      let mesh, geometry;

      init();
      animate();

      let url = window.location;
      let scheme = window.location.protocol === "https:" ? 'wss://' : 'ws://';
      let webSocketUri = scheme + url.host + '/ws';
      let ws = new WebSocket(webSocketUri);
      ws.onmessage = function(msg) {
        let pc = JSON.parse(msg.data);
        console.log(pc)
      };
      function wsSend () {
        ws.send("test");
      }
      setInterval(wsSend, 1000);

      function init() {
        camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
        camera.position.z = 400;

        scene = new THREE.Scene();

        geometry = new THREE.Geometry();
        const SIZE = 300;
        const LENGTH = 100;
        for (let i = 0; i < LENGTH; i++) {
          geometry.vertices.push(new THREE.Vector3(
            SIZE * (Math.random() - 0.5),
            SIZE * (Math.random() - 0.5),
            SIZE * (Math.random() - 0.5),
          ));
        }
        const material = new THREE.PointsMaterial({
          size: 10,
          color: 0xFFFFFF,
        });
        mesh = new THREE.Points(geometry, material);
        scene.add(mesh);

        renderer = new THREE.WebGLRenderer( { antialias: true, canvas: document.querySelector('#myCanvas')} );
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        document.body.appendChild( renderer.domElement );

        // controls
        const controls = new THREE.OrbitControls( camera, renderer.domElement );
        controls.maxPolarAngle = Math.PI * 0.5;
        controls.minDistance = 100;
        controls.maxDistance = 5000;

        window.addEventListener( 'resize', onWindowResize );

      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );
      }

      function animate() {
        requestAnimationFrame( animate );
        mesh.rotation.x += 0.005;
        mesh.rotation.y += 0.01;
        renderer.render( scene, camera );
      }
    </script>
</body>
</html>
